function MapJsonToObj(n){AvailabePlanes=n.availabePlanes;SelectedPlanes=n.selectedPlanes;RenderAvailabeList(AvailabePlanes);RenderSelectedList(SelectedPlanes)}function RenderAvailabeList(n){var i,f;let r=excludeSelectedItems(n);r=OrderBy(IsAsscending,r);let t="",u=document.getElementById("planos-genericos");ClearElement(u);t+=`<ol>`;for(i of r){t+=GetFamilyTemplateStart(i);for(f of i.planeList)t+=GetPlaneTemplate(f,i.familyId);t+=GetFamilyTemplateEnd()}t+=`</ol>`;u.innerHTML+=t}function RenderSelectedList(n){let t=[],i=document.getElementById("tabla-planos-añadidos-container");ClearElement(i);let r=0;for(var u of n)t.push(GetAddedPlaneTemplate(u,r)),r++;i.innerHTML+=t.join("")}function excludeSelectedItems(n){let t=JSON.parse(JSON.stringify(n));return SelectedPlanes.length>0&&(t=t.filter(n=>(n.planeList=n.planeList.filter(n=>!SelectedPlanes.some(t=>t.id===n.id||t.idPlane===n.id)),n.planeList.length!=0?n:void 0))),t}function FilterAvailabePlanesEventHandler(n){FilterGenericPlanList(n)}function FilterGenericPlanList(n){let i=JSON.parse(JSON.stringify(AvailabePlanes)),t;t=n!=""?i.filter(t=>(t.planeList=t.planeList.filter(t=>t.name.toLowerCase().includes(n.toLowerCase())),t.planeList.length!=0?t:void 0)):JSON.parse(JSON.stringify(AvailabePlanes));RenderAvailabeList(t)}function SetAdded(){let n,t;$.each($("input[name='generic-blueprints']:checked"),function(){if(n=this.value.split(","),t=JSON.parse(JSON.stringify(AvailabePlanes.find(t=>t.familyId===parseInt(n[0])))),t.planeList.forEach(function(n){n.familyName=t.familyName}),n.length===1){let n=t.planeList.filter(n=>!SelectedPlanes.some(t=>t.idPlane===n.id));SelectedPlanes=SelectedPlanes.concat(n)}else SelectedPlanes.some(t=>t.id===parseInt(n[1]))||SelectedPlanes.push(t.planeList.find(t=>t.id===parseInt(n[1])))});$("#planes-available-checkbox").prop("checked",!1);RenderAvailabeList(AvailabePlanes);RenderSelectedList(SelectedPlanes)}function AddNewPlane(n){n.preventDefault();document.getElementById("tabla-planos-añadidos-container").innerHTML+=GetAddedPlaneTemplate()}function Move(n,t,i){let r=SelectedPlanes.find(t=>t.id===n),u,f=!1;t==="Up"?SelectedPlanes.indexOf(r)===0?f=!0:(u=SelectedPlanes[SelectedPlanes.indexOf(r)-1],MoveBehaviour(r,u)):SelectedPlanes.indexOf(r)===SelectedPlanes.length-1?f=!0:(u=SelectedPlanes[SelectedPlanes.indexOf(r)+1],MoveBehaviour(u,r));f?i.preventDefault():RenderSelectedList(SelectedPlanes)}function MoveBehaviour(n,t){SelectedPlanes[SelectedPlanes.indexOf(n)]=t;SelectedPlanes[SelectedPlanes.indexOf(t)]=n}function deleteChecked(){$.each($("input[name='added-blueprints']:checked"),function(){deletePlaneBehaviour(parseInt(this.value))});$("#planes-selected-checkbox").prop("checked",!1);RenderAvailabeList(AvailabePlanes);RenderSelectedList(SelectedPlanes)}function deletePlaneBehaviour(n){SelectedPlanes.splice(SelectedPlanes.findIndex(t=>t.id==n),1)}function deletePlane(n,t){deletePlaneBehaviour(t);RenderAvailabeList(AvailabePlanes);RenderSelectedList(SelectedPlanes)}function OrderByBehaviour(){IsAsscending=!IsAsscending;let n=document.getElementById("search-box");n.value===""?RenderAvailabeList(AvailabePlanes):FilterGenericPlanList(n.value)}function OrderBy(n,t){let i=JSON.parse(JSON.stringify(t)),r=i.map(function(n,t){return{index:t,value:n}});r.sort(function(t,i){return n?t.index-i.index:i.index-t.index});return r.map(function(n){return i[n.index]})}function ClearElement(n){n.innerHTML=""}function setAllChecked(n,t){$("#"+n).find(":checkbox").each(function(){$(this).is(":visible")&&$(this).prop("checked",$(t).is(":checked"))})}function UploadPlanPlane(n){n.preventDefault();let r=GetPlanId(),i=document.getElementById("descripcion"),u=i.value,f=document.getElementById("familia").value,e=SelectedPlanes.length>0?SelectedPlanes[SelectedPlanes.length-1].position+1:1,o=document.getElementById("new-plane-file"),s=o.files,t=new FormData;for(var h of s)t.append("files",h);t.append("planId",r);t.append("description",u);t.append("family",f);t.append("position",e);t.append("__RequestVerificationToken",antiForgeryGen());$.ajax({url:"/planManagement/AddBlueprint/"+GetPlanId(),data:t,type:"POST",contentType:!1,processData:!1,success:function(n){(n.statusCode==undefined||n.statusCode!=404)&&(i.value="",document.getElementById("new-plane-fileDZFileNames").innerHTML="",document.getElementById("new-plane-file").value="",SelectedPlanes.push(n),RenderSelectedList(SelectedPlanes))}})}function GetFilePreview(n,t){t.preventDefault();$.ajax({url:"/planManagement/GetBlueprint/"+GetPlanId(),data:{__RequestVerificationToken:antiForgeryGen(),planeId:n},type:"GET",success:function(n){console.log(n);(n.statusCode==undefined||n.statusCode!=404)&&OpenFileView(n)}})}function OpenFileView(n){let r=document.getElementById("modal-blueprint"),u=document.getElementById("blueprints-modal-indicator"),f=document.getElementById("blueprints-modal-body");f.innerHTML="";u.innerHTML="";let i;for(var t of n)i=n.indexOf(t),u.innerHTML+=`<li data-target="#carouselExampleIndicators" data-slide-to="${i}" ${i===0?"class='active'":""}></li>`,f.innerHTML+=`<div class="carousel-item ${i===0?"active":""}">
                                <div class="carousel-caption d-none d-md-block">
                                    <h5>${t.name}</h5>
                                </div>
                              <img class="d-block" src="${"data:image/"+t.fileName.substr(t.fileName.lastIndexOf(".")+1)+";base64,"+t.data}" alt="">
                            </div>`;n.length!=0&&(r.classList.add("show"),r.style.display="block",r.ariaHidden="false")}function CloseModal(n,t){n.preventDefault();let i=document.getElementById(t);i.classList.remove("show");i.style.display="none";i.ariaHidden="true"}function GetFamilyTemplateStart(n){return`  
        <li class="accordion-firstlevel" style=" list-style-type: none;">
            <div class="accordion-container">
                <div class="activities-actions align-left">
                    <div class="form-check">
                        <label>
                          <input class="form-check-input" type="checkbox" name="generic-blueprints" value="${n.familyId}">
                              <span class="form-check-sign"><span class="check"></span></span>
                        </label>

                            </div>
                    </div>
                    <a data-toggle="collapse" href="#collapseTrabajo${n.familyId===3?"-5":n.familyId}" aria-expanded="true" aria-controls="collapseTrabajo4" class="accordion-toggle">${n.familyName}</a>
                    <div class="activities-actions align-right mr-2">
                                    

                       

                     </div>
               </div>
           <ol id="collapseTrabajo${n.familyId}" data-parent=".accordion-firstlevel" class="collapse show">

                      `}function GetFamilyTemplateEnd(){return` </ol>
         </li>
    `}function GetPlaneTemplate(n,t){return`<li class="accordion-secondlevel">
        <div class="accordion-container">
            <div class="activities-actions align-left">
                <div class="form-check">
                        <label>
                              <input class="form-check-input" type="checkbox" name="generic-blueprints" value="${t},${n.id}">
                              <span class="form-check-sign"><span class="check"></span></span>
                        </label>
                </div>
             </div>
             <span class="accordion-toggle">${n.name}</span>
             <div class="activities-actions align-right mr-2">

                <button class="btn btn-just-icon btn-link btn-round disabled" onclick = "GetFilePreview(${n.id},event)" >
                    <i class="fas fa-image"></i>
                        <div class="ripple-container"></div>
                 </button>
             </div>
        </div>
    </li>`}function GetAddedPlaneTemplate(n,t){let i=SelectedPlanes.indexOf(n)+1,r=`<tr id="addedPlan${n.id}">
                <td class="text-left">
                    <div class="form-check">
                        <label>
                            <input class="form-check-input" type="checkbox" name="added-blueprints" value="">
                            <span class="form-check-sign"><span class="check"></span></span>
                            <input type="hidden" name="SelectedPlanes[${t}].Id" value="${n.id}" />
                        </label>
                    </div>
                </td>
                <td class="text-center">${i}
                    <input type="hidden" name="SelectedPlanes[${t}].Position" value="${i}" />
                    <input type="hidden" name="SelectedPlanes[${t}].IdPlane" value="${n.idPlane===undefined?n.id:n.idPlane}" />
                </td>
                <td class="text-left articulo">${n.name===undefined?n.description:n.name}
                    <input name="SelectedPlanes[${t}].Description" value="${n.name===undefined?n.description:n.name}" />
                </td>
                <td class="text-left">${n.familyName}
                    <input name="SelectedPlanes[${t}].FamilyName" value="${n.familyName}" />
                </td>
                <td class="text-center">
                <button class="btn btn-just-icon btn-link btn-round  ${n.containsFile?"":"disabled"}" onclick="GetFilePreview(${n.id},event)" >
                    <i class="fas fa-image"></i>
                    <div class="ripple-container"></div>
                </button>
                </td>
                    `;return editEnabled&&(r+=` <td class="text-center">
                            <button class="btn btn-just-icon btn-link btn-round btn-sm"onclick="Move(${n.id},'Up',event)"> <i class="fas fa-angle-up"></i> <div class="ripple-container"></div></button>
                            <button class="btn btn-just-icon btn-link btn-round btn-sm"onclick="Move(${n.id},'Down',event)"> <i class="fas fa-angle-down"></i> </button>
                           </td >

    
                        <td class="text-right">

                                <div class="dropdown ml-1">
                                    <button class="dropdown-toggle btn btn-just-icon btn-link btn-round btn-sm pl-2" type="button" id="dropdownMenuButton21" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <span class="fas fa-ellipsis-v"></span> </button>
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton21" x-placement="bottom-start">
                                        <a class="dropdown-item" onclick="deletePlane(event,${n.id})">${locations["Planes.OpcionTable.Eliminar"]}</a></div>
                                </div>
                            </td>`),r+`</tr>`}var AvailabePlanes=[],SelectedPlanes=[],IsAsscending=!0;